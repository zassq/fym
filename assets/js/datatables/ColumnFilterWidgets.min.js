(function(d){d.fn.dataTableExt.oApi.fnGetColumnData=function(b,a,d,e,c){if("undefined"==typeof a)return[];"undefined"==typeof d&&(d=!0);"undefined"==typeof e&&(e=!0);"undefined"==typeof c&&(c=!0);b=!0==e?b.aiDisplay:b.aiDisplayMaster;e=[];for(var g=0,k=b.length;g<k;g++){var l=this.fnGetData(b[g],a);if(!0!=c||0!=l.length)!0==d&&-1<jQuery.inArray(l,e)||e.push(l)}return e};var m=function(b){var a=this,f="";a.$WidgetContainer=d('<div class="column-filter-widgets"></div>');a.$MenuContainer=a.$WidgetContainer;
a.$TermContainer=null;a.aoWidgets=[];a.sSeparator="";"oColumnFilterWidgets"in b.oInit&&("aiExclude"in b.oInit.oColumnFilterWidgets&&(f="|"+b.oInit.oColumnFilterWidgets.aiExclude.join("|")+"|"),"bGroupTerms"in b.oInit.oColumnFilterWidgets&&b.oInit.oColumnFilterWidgets.bGroupTerms&&(a.$MenuContainer=d('<div class="column-filter-widget-menus clearfix"></div>'),a.$TermContainer=d('<div class="column-filter-widget-selected-terms col-xs-12 col-sm-12 col-md-12"></div>').hide()));d.each(b.aoColumns,function(e,
c){var g=d('<div class="column-filter-widget col-xs-6 col-sm-6 col-md-3"></div>');0>f.indexOf("|"+e+"|")&&(a.aoWidgets.push(new h(g,b,e,a)),a.$MenuContainer.append(g))});a.$TermContainer&&(a.$TermContainer.prepend("<p><strong>\u8fc7\u6ee4\u6761\u4ef6\uff08\u5355\u51fb\u53bb\u9664\u5df2\u9009\u6761\u4ef6\uff09\uff1a</strong></p>"),a.$WidgetContainer.append('<div class="col-md-12"><h3>\u8fc7\u6ee4</h3></div>'),a.$WidgetContainer.append(a.$MenuContainer),a.$WidgetContainer.append(a.$TermContainer));
b.aoDrawCallback.push({name:"ColumnFilterWidgets",fn:function(b){d.each(a.aoWidgets,function(a,d){d.fnDraw(b.jqXHR.responseJSON.ccData)})}});return a};m.prototype.getContainer=function(){return this.$WidgetContainer.get(0)};var h=function(b,a,f,e){var c=this;c.iColumn=f;c.oColumn=a.aoColumns[f];c.$Container=b;c.oDataTable=a.oInstance;c.asFilters=[];c.sSeparator="";c.bSort=!0;c.iMaxSelections=-1;c.bServerSide=a.oInit.bServerSide;c.aaData=a.oInit.aaData;"oColumnFilterWidgets"in a.oInit&&("sSeparator"in
a.oInit.oColumnFilterWidgets&&(c.sSeparator=a.oInit.oColumnFilterWidgets.sSeparator),"iMaxSelections"in a.oInit.oColumnFilterWidgets&&(c.iMaxSelections=a.oInit.oColumnFilterWidgets.iMaxSelections),"aoColumnDefs"in a.oInit.oColumnFilterWidgets&&d.each(a.oInit.oColumnFilterWidgets.aoColumnDefs,function(a,b){0<=("|"+b.aiTargets.join("|")+"|").indexOf("|"+f+"|")&&d.each(b,function(a,b){c[a]=b})}));c.$Select=d('<select class="form-control input-sm"></select>').change(function(){var a=c.$Select.val(),b,
f,n;""!==a&&(b=d("<div>"+a+"</div>").text(),f=d('<a class="filter-term" href="#"></a>').addClass("filter-term-"+b.toLowerCase().replace(/\W/g,"")).text(b).click(function(){c.asFilters=d.grep(c.asFilters,function(b){return b!=a});f.remove();e.$TermContainer&&0===e.$TermContainer.find(".filter-term").length&&e.$TermContainer.hide();c.$Select.append(d("<option></option>").attr("value",a).text(b));0<c.iMaxSelections&&c.iMaxSelections>c.asFilters.length&&c.$Select.attr("disabled",!1);c.fnFilter();return!1}),
c.asFilters.push(a),e.$TermContainer?(e.$TermContainer.show(),e.$TermContainer.append(f)):c.$Select.after(f),n=c.$Select.children("option:selected"),c.$Select.val(""),n.remove(),0<c.iMaxSelections&&c.iMaxSelections<=c.asFilters.length&&c.$Select.attr("disabled",!0),c.fnFilter())});c.$Container.append(c.$Select);c.fnDraw(null)};h.prototype.fnFilter=function(){var b=[],a,f;0<this.asFilters.length?(d.each(this.asFilters,function(a,c){b.push(c.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"))}),this.bServerSide?
this.oDataTable.fnFilter(b.join("|"),this.iColumn,!1,!1):(a=this.sSeparator?"(^|"+this.sSeparator+")(":"^(",f=this.sSeparator?")("+this.sSeparator+"|$)":")$",this.oDataTable.fnFilter(a+b.join("|")+f,this.iColumn,!0,!1))):this.oDataTable.fnFilter("",this.iColumn)};h.prototype.fnGetAjaxColumnData=function(b,a){return"undefined"==typeof b||null==a||1>a.length||null==a[b]||"undefined"==typeof a[b]?[]:a[b]};h.prototype.fnDraw=function(b){var a=this,f={},e=[];0===a.asFilters.length&&(b=null==b?a.oDataTable.fnGetColumnData(a.iColumn):
a.fnGetAjaxColumnData(a.iColumn,b),d.each(b,function(b,g){var k=a.sSeparator?g.split(RegExp(a.sSeparator)):[g];d.each(k,function(a,b){f.hasOwnProperty(b)||(f[b]=!0,e.push(b))})}),a.$Select.empty().append(d("<option></option>").attr("value","").text(a.oColumn.sTitle)),a.bSort&&(a.hasOwnProperty("fnSort")?e.sort(a.fnSort):e.sort()),d.each(e,function(b,e){var f;f=d("<div>"+e+"</div>").text();a.$Select.append(d("<option></option>").attr("value",e).text(f))}),1<e.length?a.$Select.attr("disabled",!1):a.$Select.attr("disabled",
!0))};if("function"===typeof d.fn.dataTable&&"function"===typeof d.fn.dataTableExt.fnVersionCheck&&d.fn.dataTableExt.fnVersionCheck("1.7.0"))d.fn.dataTableExt.aoFeatures.push({fnInit:function(b){return(new m(b)).getContainer()},cFeature:"W",sFeature:"ColumnFilterWidgets"});else throw"Warning: ColumnFilterWidgets requires DataTables 1.7 or greater - www.datatables.net/download";})(jQuery);